<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Customer Support Agent - E-commerce Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
    tailwind.config = {
        theme: {
            extend: {
                borderRadius: {
                    lg: "var(--radius)",
                    md: "calc(var(--radius) - 2px)",
                    sm: "calc(var(--radius) - 4px)",
                },
                colors: {
                    background: "var(--background)",
                    foreground: "var(--foreground)",
                    card: {
                        DEFAULT: "var(--card)",
                        foreground: "var(--card-foreground)",
                    },
                    popover: {
                        DEFAULT: "var(--popover)",
                        foreground: "var(--popover-foreground)",
                    },
                    primary: {
                        DEFAULT: "var(--primary)",
                        foreground: "var(--primary-foreground)",
                    },
                    secondary: {
                        DEFAULT: "var(--secondary)",
                        foreground: "var(--secondary-foreground)",
                    },
                    muted: {
                        DEFAULT: "var(--muted)",
                        foreground: "var(--muted-foreground)",
                    },
                    accent: {
                        DEFAULT: "var(--accent)",
                        foreground: "var(--accent-foreground)",
                    },
                    destructive: {
                        DEFAULT: "var(--destructive)",
                        foreground: "var(--destructive-foreground)",
                    },
                    border: "var(--border)",
                    input: "var(--input)",
                    ring: "var(--ring)",
                }
            },
            fontFamily: {
                sans: ["Inter", "system-ui", "sans-serif"],
            }
        }
    };
    </script>
    <style>
        :root {
            --background: hsl(210 40% 98%);
            --foreground: hsl(222.2 84% 4.9%);
            --card: hsl(0 0% 100%);
            --card-foreground: hsl(222.2 84% 4.9%);
            --popover: hsl(0 0% 100%);
            --popover-foreground: hsl(222.2 84% 4.9%);
            --primary: hsl(221.2 83.2% 53.3%);
            --primary-foreground: hsl(210 40% 98%);
            --secondary: hsl(210 40% 96%);
            --secondary-foreground: hsl(222.2 84% 4.9%);
            --muted: hsl(210 40% 96%);
            --muted-foreground: hsl(215.4 16.3% 46.9%);
            --accent: hsl(210 40% 96%);
            --accent-foreground: hsl(222.2 84% 4.9%);
            --destructive: hsl(0 84.2% 60.2%);
            --destructive-foreground: hsl(210 40% 98%);
            --border: hsl(214.3 31.8% 91.4%);
            --input: hsl(214.3 31.8% 91.4%);
            --ring: hsl(221.2 83.2% 53.3%);
            --radius: 0.5rem;
        }
        
        .dark {
            --background: hsl(222.2 84% 4.9%);
            --foreground: hsl(210 40% 98%);
            --card: hsl(222.2 84% 4.9%);
            --card-foreground: hsl(210 40% 98%);
            --popover: hsl(222.2 84% 4.9%);
            --popover-foreground: hsl(210 40% 98%);
            --primary: hsl(217.2 91.2% 59.8%);
            --primary-foreground: hsl(222.2 84% 4.9%);
            --secondary: hsl(217.2 32.6% 17.5%);
            --secondary-foreground: hsl(210 40% 98%);
            --muted: hsl(217.2 32.6% 17.5%);
            --muted-foreground: hsl(215 20.2% 65.1%);
            --accent: hsl(217.2 32.6% 17.5%);
            --accent-foreground: hsl(210 40% 98%);
            --destructive: hsl(0 62.8% 30.6%);
            --destructive-foreground: hsl(210 40% 98%);
            --border: hsl(217.2 32.6% 17.5%);
            --input: hsl(217.2 32.6% 17.5%);
            --ring: hsl(224.3 76.3% 94.1%);
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-background text-foreground min-h-screen">
    <!-- @COMPONENT: Header -->
    <header class="bg-card border-b border-border px-6 py-4 sticky top-0 z-50">
        <div class="flex items-center justify-between max-w-7xl mx-auto">
            <div class="flex items-center space-x-3">
                <div class="bg-primary text-primary-foreground p-2 rounded-lg">
                    <i class="fas fa-robot text-xl"></i>
                </div>
                <div>
                    <h1 class="text-xl font-semibold text-foreground">AI Customer Support</h1>
                    <p class="text-sm text-muted-foreground">Powered by Gemini API & RAG System</p>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="text-sm text-muted-foreground">
                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium">
                        <i class="fas fa-circle text-green-500 mr-1"></i>Online
                    </span>
                </div>
                <div class="text-sm text-muted-foreground">
                    <span data-bind="rateLimiter.remaining">22</span>/25 queries today
                </div>
            </div>
        </div>
    </header>
    <!-- @END_COMPONENT: Header -->

    <div class="flex h-[calc(100vh-80px)]">
        <!-- @COMPONENT: Sidebar -->
        <aside class="w-80 bg-card border-r border-border overflow-y-auto">
            <div class="p-6">
                <div class="mb-6">
                    <h2 class="text-lg font-semibold mb-2">Quick Help</h2>
                    <p class="text-sm text-muted-foreground">Browse frequently asked questions or start a conversation below.</p>
                </div>

                <!-- FAQ Categories -->
                <div class="space-y-3">
                    <!-- @MAP: faqCategories.map(category => ( -->
                    <div class="border border-border rounded-lg">
                        <button class="w-full p-4 text-left hover:bg-secondary transition-colors duration-200 rounded-lg" data-event="click:toggleCategory">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-shopping-cart text-primary"></i>
                                    <span class="font-medium">Orders</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs bg-muted text-muted-foreground px-2 py-1 rounded-full" data-bind="category.count">127</span>
                                    <i class="fas fa-chevron-down text-muted-foreground"></i>
                                </div>
                            </div>
                        </button>
                        <div class="px-4 pb-4 space-y-2" data-mock="true">
                            <button class="w-full text-left p-2 text-sm hover:bg-secondary rounded transition-colors duration-200" data-event="click:selectFAQ">
                                How do I track my order?
                            </button>
                            <button class="w-full text-left p-2 text-sm hover:bg-secondary rounded transition-colors duration-200" data-event="click:selectFAQ">
                                When will my order be processed?
                            </button>
                            <button class="w-full text-left p-2 text-sm hover:bg-secondary rounded transition-colors duration-200" data-event="click:selectFAQ">
                                Can I modify my order after placing it?
                            </button>
                        </div>
                    </div>

                    <div class="border border-border rounded-lg">
                        <button class="w-full p-4 text-left hover:bg-secondary transition-colors duration-200 rounded-lg" data-event="click:toggleCategory">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-credit-card text-primary"></i>
                                    <span class="font-medium">Payments</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs bg-muted text-muted-foreground px-2 py-1 rounded-full" data-bind="category.count">98</span>
                                    <i class="fas fa-chevron-right text-muted-foreground"></i>
                                </div>
                            </div>
                        </button>
                    </div>

                    <div class="border border-border rounded-lg">
                        <button class="w-full p-4 text-left hover:bg-secondary transition-colors duration-200 rounded-lg" data-event="click:toggleCategory">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-undo text-primary"></i>
                                    <span class="font-medium">Returns & Refunds</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs bg-muted text-muted-foreground px-2 py-1 rounded-full" data-bind="category.count">156</span>
                                    <i class="fas fa-chevron-right text-muted-foreground"></i>
                                </div>
                            </div>
                        </button>
                    </div>

                    <div class="border border-border rounded-lg">
                        <button class="w-full p-4 text-left hover:bg-secondary transition-colors duration-200 rounded-lg" data-event="click:toggleCategory">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-times-circle text-primary"></i>
                                    <span class="font-medium">Cancellations</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs bg-muted text-muted-foreground px-2 py-1 rounded-full" data-bind="category.count">74</span>
                                    <i class="fas fa-chevron-right text-muted-foreground"></i>
                                </div>
                            </div>
                        </button>
                    </div>

                    <div class="border border-border rounded-lg">
                        <button class="w-full p-4 text-left hover:bg-secondary transition-colors duration-200 rounded-lg" data-event="click:toggleCategory">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-crown text-primary"></i>
                                    <span class="font-medium">Membership / Prime</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs bg-muted text-muted-foreground px-2 py-1 rounded-full" data-bind="category.count">89</span>
                                    <i class="fas fa-chevron-right text-muted-foreground"></i>
                                </div>
                            </div>
                        </button>
                    </div>

                    <div class="border border-border rounded-lg">
                        <button class="w-full p-4 text-left hover:bg-secondary transition-colors duration-200 rounded-lg" data-event="click:toggleCategory">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-truck text-primary"></i>
                                    <span class="font-medium">Delivery</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs bg-muted text-muted-foreground px-2 py-1 rounded-full" data-bind="category.count">143</span>
                                    <i class="fas fa-chevron-right text-muted-foreground"></i>
                                </div>
                            </div>
                        </button>
                    </div>

                    <div class="border border-border rounded-lg">
                        <button class="w-full p-4 text-left hover:bg-secondary transition-colors duration-200 rounded-lg" data-event="click:toggleCategory">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-shield-alt text-primary"></i>
                                    <span class="font-medium">Warranty & Repairs</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs bg-muted text-muted-foreground px-2 py-1 rounded-full" data-bind="category.count">67</span>
                                    <i class="fas fa-chevron-right text-muted-foreground"></i>
                                </div>
                            </div>
                        </button>
                    </div>

                    <div class="border border-border rounded-lg">
                        <button class="w-full p-4 text-left hover:bg-secondary transition-colors duration-200 rounded-lg" data-event="click:toggleCategory">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-gift text-primary"></i>
                                    <span class="font-medium">Gift Cards & Coupons</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs bg-muted text-muted-foreground px-2 py-1 rounded-full" data-bind="category.count">52</span>
                                    <i class="fas fa-chevron-right text-muted-foreground"></i>
                                </div>
                            </div>
                        </button>
                    </div>

                    <div class="border border-border rounded-lg">
                        <button class="w-full p-4 text-left hover:bg-secondary transition-colors duration-200 rounded-lg" data-event="click:toggleCategory">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-user-shield text-primary"></i>
                                    <span class="font-medium">Account & Security</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs bg-muted text-muted-foreground px-2 py-1 rounded-full" data-bind="category.count">91</span>
                                    <i class="fas fa-chevron-right text-muted-foreground"></i>
                                </div>
                            </div>
                        </button>
                    </div>

                    <div class="border border-border rounded-lg">
                        <button class="w-full p-4 text-left hover:bg-secondary transition-colors duration-200 rounded-lg" data-event="click:toggleCategory">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-globe text-primary"></i>
                                    <span class="font-medium">International Shipping</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs bg-muted text-muted-foreground px-2 py-1 rounded-full" data-bind="category.count">38</span>
                                    <i class="fas fa-chevron-right text-muted-foreground"></i>
                                </div>
                            </div>
                        </button>
                    </div>
                    <!-- @END_MAP -->

                    <!-- Other/Direct Chat Option -->
                    <div class="border-2 border-dashed border-primary/30 rounded-lg">
                        <button class="w-full p-4 text-left hover:bg-primary/5 transition-colors duration-200 rounded-lg" data-event="click:startDirectChat">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-comments text-primary"></i>
                                <div>
                                    <span class="font-medium text-primary">Ask Something Else</span>
                                    <p class="text-xs text-muted-foreground mt-1">Start a conversation with our AI assistant</p>
                                </div>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Knowledge Base Stats -->
                <div class="mt-6 p-4 bg-secondary rounded-lg">
                    <h3 class="font-medium text-sm mb-2">Knowledge Base</h3>
                    <div class="space-y-2 text-xs text-muted-foreground">
                        <div class="flex justify-between">
                            <span>Total FAQs:</span>
                            <span class="font-medium" data-bind="knowledgeBase.totalEntries">1,247</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Last Updated:</span>
                            <span data-bind="knowledgeBase.lastUpdate">2 hours ago</span>
                        </div>
                        <div class="flex justify-between">
                            <span>RAG Accuracy:</span>
                            <span class="text-green-600 font-medium" data-bind="knowledgeBase.accuracy">96.8%</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
        <!-- @END_COMPONENT: Sidebar -->

        <!-- @COMPONENT: ChatArea -->
        <main class="flex-1 flex flex-col bg-background">
            <!-- Chat Header -->
            <div class="bg-card border-b border-border p-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="bg-primary/10 p-2 rounded-full">
                            <i class="fas fa-robot text-primary"></i>
                        </div>
                        <div>
                            <h2 class="font-semibold">AI Customer Support Agent</h2>
                            <p class="text-sm text-muted-foreground">
                                <span class="inline-flex items-center">
                                    <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                    Online • Powered by Gemini API
                                </span>
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full font-medium">
                            RAG + AI Hybrid
                        </span>
                        <button class="p-2 hover:bg-secondary rounded-lg transition-colors duration-200" data-event="click:clearChat">
                            <i class="fas fa-trash text-muted-foreground"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chat Messages -->
            <div class="flex-1 overflow-y-auto p-6 space-y-4" id="chatMessages">
                <!-- Welcome Message -->
                <div class="flex items-start space-x-3">
                    <div class="bg-primary p-2 rounded-full flex-shrink-0">
                        <i class="fas fa-robot text-primary-foreground text-sm"></i>
                    </div>
                    <div class="bg-card border border-border rounded-lg p-4 max-w-2xl">
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="font-medium text-sm">AI Support Agent</span>
                            <span class="text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full">Instant</span>
                        </div>
                        <p class="text-sm text-foreground">
                            Welcome! I'm your AI customer support assistant. I have access to over <strong>1,247 FAQ entries</strong> and can help you with orders, payments, returns, and more. 
                        </p>
                        <p class="text-sm text-muted-foreground mt-2">
                            Browse the categories on the left for instant answers, or type your question below for a personalized response.
                        </p>
                    </div>
                </div>

                <!-- Sample FAQ Response -->
                <div class="flex items-start space-x-3" data-mock="true">
                    <div class="bg-primary p-2 rounded-full flex-shrink-0">
                        <i class="fas fa-robot text-primary-foreground text-sm"></i>
                    </div>
                    <div class="bg-card border border-border rounded-lg p-4 max-w-2xl">
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="font-medium text-sm">AI Support Agent</span>
                            <span class="text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded-full">
                                <i class="fas fa-database mr-1"></i>Knowledge Base
                            </span>
                        </div>
                        <p class="text-sm text-foreground">
                            <strong>Tracking Information:</strong> Tracking details are updated within 12 hours of dispatch and can be found in your Orders section or via the tracking link sent to your email.
                        </p>
                        <div class="mt-3 pt-3 border-t border-border">
                            <div class="flex items-center justify-between text-xs text-muted-foreground">
                                <span>Source: FAQ #124 • Orders Category</span>
                                <span>Response time: 0.3s</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sample User Question -->
                <div class="flex items-start space-x-3 justify-end" data-mock="true">
                    <div class="bg-primary text-primary-foreground rounded-lg p-4 max-w-2xl">
                        <p class="text-sm">
                            I ordered a laptop 3 days ago but haven't received any shipping confirmation. What should I do?
                        </p>
                        <div class="mt-2 text-xs text-primary-foreground/80">
                            <i class="fas fa-clock mr-1"></i>Just now
                        </div>
                    </div>
                    <div class="bg-muted p-2 rounded-full flex-shrink-0">
                        <i class="fas fa-user text-muted-foreground text-sm"></i>
                    </div>
                </div>

                <!-- Sample Gemini API Response -->
                <div class="flex items-start space-x-3" data-mock="true">
                    <div class="bg-primary p-2 rounded-full flex-shrink-0">
                        <i class="fas fa-robot text-primary-foreground text-sm"></i>
                    </div>
                    <div class="bg-card border border-border rounded-lg p-4 max-w-2xl">
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="font-medium text-sm">AI Support Agent</span>
                            <span class="text-xs bg-purple-100 text-purple-800 px-2 py-0.5 rounded-full">
                                <i class="fas fa-brain mr-1"></i>Gemini AI
                            </span>
                        </div>
                        <p class="text-sm text-foreground">
                            I understand your concern about the delayed shipping confirmation. For laptop orders, sellers typically have 48 hours to dispatch, and you should receive tracking details within 12 hours of dispatch. 
                        </p>
                        <p class="text-sm text-foreground mt-2">
                            Since it's been 3 days, I recommend checking your Orders section for any updates. If no shipping confirmation appears by tomorrow, please contact our support team for immediate assistance with order #<span data-bind="order.id">AMZ123456789</span>.
                        </p>
                        <div class="mt-3 pt-3 border-t border-border">
                            <div class="flex items-center justify-between text-xs text-muted-foreground">
                                <span>Generated response using 3 relevant KB entries</span>
                                <span>Response time: 1.2s</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Rate Limit Warning (Conditional) -->
                <div class="flex items-start space-x-3" data-mock="true" style="display: none;" id="rateLimitWarning">
                    <div class="bg-amber-500 p-2 rounded-full flex-shrink-0">
                        <i class="fas fa-exclamation-triangle text-white text-sm"></i>
                    </div>
                    <div class="bg-amber-50 border border-amber-200 rounded-lg p-4 max-w-2xl">
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="font-medium text-sm text-amber-800">Usage Limit Notice</span>
                            <span class="text-xs bg-amber-200 text-amber-800 px-2 py-0.5 rounded-full">System</span>
                        </div>
                        <p class="text-sm text-amber-700">
                            You're approaching your daily query limit (23/25 used). After reaching the limit, please try again tomorrow or contact customer care directly.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Chat Input -->
            <div class="border-t border-border p-4 bg-card">
                <div class="flex items-end space-x-3">
                    <div class="flex-1">
                        <div class="relative">
                            <textarea 
                                class="w-full resize-none border border-border rounded-lg px-4 py-3 pr-12 focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200 text-sm"
                                placeholder="Type your question here... (e.g., 'How do I return an item?')"
                                rows="1"
                                data-bind="chatInput.value"
                                data-event="keydown:handleKeyPress"
                                data-implementation="Auto-resize textarea based on content"></textarea>
                            <button class="absolute bottom-3 right-3 text-muted-foreground hover:text-primary transition-colors duration-200" data-event="click:attachFile">
                                <i class="fas fa-paperclip"></i>
                            </button>
                        </div>
                        <div class="flex items-center justify-between mt-2 text-xs text-muted-foreground">
                            <div class="flex items-center space-x-4">
                                <span>
                                    <i class="fas fa-database mr-1"></i>
                                    RAG Search Enabled
                                </span>
                                <span>
                                    <i class="fas fa-brain mr-1"></i>
                                    Gemini Fallback Active
                                </span>
                            </div>
                            <span><span data-bind="chatInput.charCount">0</span>/500 characters</span>
                        </div>
                    </div>
                    <button 
                        class="bg-primary text-primary-foreground px-6 py-3 rounded-lg hover:bg-primary/90 transition-colors duration-200 flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed"
                        data-event="click:sendMessage"
                        data-implementation="Implement RAG search followed by Gemini API call if needed">
                        <i class="fas fa-paper-plane"></i>
                        <span class="hidden sm:inline">Send</span>
                    </button>
                </div>
            </div>
        </main>
        <!-- @END_COMPONENT: ChatArea -->
    </div>

    <!-- @COMPONENT: RAGProcessModal (Hidden by default) -->
    <div class="fixed inset-0 bg-black/50 z-50 hidden" id="ragProcessModal" data-implementation="Show during RAG processing">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-card rounded-xl p-6 max-w-md w-full">
                <div class="text-center">
                    <div class="bg-primary/10 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-brain text-primary text-2xl animate-pulse"></i>
                    </div>
                    <h3 class="font-semibold text-lg mb-2">Processing Your Query</h3>
                    <div class="space-y-3 text-sm text-muted-foreground">
                        <div class="flex items-center justify-between">
                            <span>Searching Knowledge Base...</span>
                            <i class="fas fa-check text-green-500"></i>
                        </div>
                        <div class="flex items-center justify-between">
                            <span>Calculating Similarity...</span>
                            <i class="fas fa-spinner animate-spin text-primary"></i>
                        </div>
                        <div class="flex items-center justify-between opacity-50">
                            <span>Consulting Gemini AI...</span>
                            <i class="fas fa-clock text-muted-foreground"></i>
                        </div>
                    </div>
                    <div class="mt-4 bg-secondary rounded-lg p-3">
                        <div class="text-xs text-muted-foreground">
                            <div class="flex justify-between mb-1">
                                <span>Vectors Searched:</span>
                                <span data-bind="rag.vectorsSearched">1,247</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Best Match Score:</span>
                                <span data-bind="rag.bestScore">0.89</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- @END_COMPONENT: RAGProcessModal -->

    <!-- @COMPONENT: KnowledgeBaseViewer (Hidden by default) -->
    <div class="fixed inset-0 bg-black/50 z-50 hidden" id="knowledgeBaseModal" data-implementation="Show KB entries management">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-card rounded-xl p-6 max-w-4xl w-full max-h-[80vh] overflow-hidden">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h3 class="font-semibold text-xl">Knowledge Base</h3>
                        <p class="text-sm text-muted-foreground">1,247 FAQ entries across 10 categories</p>
                    </div>
                    <button class="p-2 hover:bg-secondary rounded-lg" data-event="click:closeKBModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 overflow-y-auto max-h-96">
                    <!-- Sample KB Entry Cards -->
                    <div class="border border-border rounded-lg p-4" data-mock="true">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">Orders</span>
                            <span class="text-xs text-muted-foreground">#001</span>
                        </div>
                        <h4 class="font-medium text-sm mb-2">Order Processing Time</h4>
                        <p class="text-xs text-muted-foreground mb-2">Orders placed before 6 PM are processed the same day.</p>
                        <div class="flex items-center justify-between text-xs">
                            <span class="text-green-600">High Confidence</span>
                            <span>Used 47 times</span>
                        </div>
                    </div>

                    <div class="border border-border rounded-lg p-4" data-mock="true">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">Payments</span>
                            <span class="text-xs text-muted-foreground">#156</span>
                        </div>
                        <h4 class="font-medium text-sm mb-2">Payment Method Security</h4>
                        <p class="text-xs text-muted-foreground mb-2">All payment methods use 256-bit SSL encryption for security.</p>
                        <div class="flex items-center justify-between text-xs">
                            <span class="text-green-600">High Confidence</span>
                            <span>Used 23 times</span>
                        </div>
                    </div>

                    <div class="border border-border rounded-lg p-4" data-mock="true">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded-full">Returns</span>
                            <span class="text-xs text-muted-foreground">#234</span>
                        </div>
                        <h4 class="font-medium text-sm mb-2">Return Window Policy</h4>
                        <p class="text-xs text-muted-foreground mb-2">Electronics have a 10-day return window from delivery date.</p>
                        <div class="flex items-center justify-between text-xs">
                            <span class="text-amber-600">Medium Confidence</span>
                            <span>Used 89 times</span>
                        </div>
                    </div>
                    <!-- Add more KB entries as needed -->
                </div>
            </div>
        </div>
    </div>
    <!-- @END_COMPONENT: KnowledgeBaseViewer -->

    <script>
        // TODO: Implement RAG system with vector embeddings
        // TODO: Integrate Gemini API 2.0 Flash
        // TODO: Implement rate limiting middleware
        // TODO: Add cosine similarity calculation for KB matching
        // TODO: Implement session management for query tracking
        
        (function() {
            // Basic UI interactions for demonstration
            let queryCount = 22;
            const maxQueries = 25;

            // FAQ Category Toggle
            document.addEventListener('click', function(e) {
                if (e.target.closest('[data-event*="toggleCategory"]')) {
                    const button = e.target.closest('button');
                    const content = button.nextElementSibling;
                    const icon = button.querySelector('.fa-chevron-down, .fa-chevron-right');
                    
                    if (content.style.display === 'none' || !content.style.display) {
                        content.style.display = 'block';
                        icon.classList.remove('fa-chevron-right');
                        icon.classList.add('fa-chevron-down');
                    } else {
                        content.style.display = 'none';
                        icon.classList.remove('fa-chevron-down');
                        icon.classList.add('fa-chevron-right');
                    }
                }

                // FAQ Selection
                if (e.target.closest('[data-event*="selectFAQ"]')) {
                    const faqText = e.target.textContent;
                    addMessage('user', faqText);
                    
                    // Simulate instant KB response
                    setTimeout(() => {
                        addMessage('bot', `Here's the answer from our knowledge base: [Instant response for "${faqText}"]`, 'knowledge-base');
                    }, 300);
                }

                // Send Message
                if (e.target.closest('[data-event*="sendMessage"]')) {
                    const textarea = document.querySelector('textarea');
                    const message = textarea.value.trim();
                    
                    if (message && queryCount < maxQueries) {
                        addMessage('user', message);
                        textarea.value = '';
                        queryCount++;
                        
                        // Update query counter
                        document.querySelector('[data-bind="rateLimiter.remaining"]').textContent = maxQueries - queryCount;
                        
                        // Simulate RAG processing
                        showRAGProcess();
                        
                        setTimeout(() => {
                            hideRAGProcess();
                            addMessage('bot', 'This is a simulated response from our AI system. In production, this would trigger RAG search and potentially Gemini API call.', 'gemini-ai');
                        }, 2000);
                    } else if (queryCount >= maxQueries) {
                        addMessage('bot', 'Daily free usage limit reached. Please try again tomorrow.', 'system');
                    }
                }
            });

            // Auto-resize textarea
            document.querySelector('textarea').addEventListener('input', function(e) {
                e.target.style.height = 'auto';
                e.target.style.height = Math.min(e.target.scrollHeight, 120) + 'px';
                
                // Update character count
                document.querySelector('[data-bind="chatInput.charCount"]').textContent = e.target.value.length;
            });

            // Enter key to send
            document.querySelector('textarea').addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    document.querySelector('[data-event*="sendMessage"]').click();
                }
            });

            function addMessage(type, text, source = 'instant') {
                const chatMessages = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                
                if (type === 'user') {
                    messageDiv.innerHTML = `
                        <div class="flex items-start space-x-3 justify-end">
                            <div class="bg-primary text-primary-foreground rounded-lg p-4 max-w-2xl">
                                <p class="text-sm">${text}</p>
                                <div class="mt-2 text-xs text-primary-foreground/80">
                                    <i class="fas fa-clock mr-1"></i>Just now
                                </div>
                            </div>
                            <div class="bg-muted p-2 rounded-full flex-shrink-0">
                                <i class="fas fa-user text-muted-foreground text-sm"></i>
                            </div>
                        </div>
                    `;
                } else {
                    const sourceConfig = {
                        'instant': { bg: 'bg-primary/10', text: 'text-primary', icon: 'fas fa-bolt', label: 'Instant' },
                        'knowledge-base': { bg: 'bg-green-100', text: 'text-green-800', icon: 'fas fa-database', label: 'Knowledge Base' },
                        'gemini-ai': { bg: 'bg-purple-100', text: 'text-purple-800', icon: 'fas fa-brain', label: 'Gemini AI' },
                        'system': { bg: 'bg-amber-100', text: 'text-amber-800', icon: 'fas fa-exclamation-triangle', label: 'System' }
                    };
                    
                    const config = sourceConfig[source] || sourceConfig['instant'];
                    
                    messageDiv.innerHTML = `
                        <div class="flex items-start space-x-3">
                            <div class="bg-primary p-2 rounded-full flex-shrink-0">
                                <i class="fas fa-robot text-primary-foreground text-sm"></i>
                            </div>
                            <div class="bg-card border border-border rounded-lg p-4 max-w-2xl">
                                <div class="flex items-center space-x-2 mb-2">
                                    <span class="font-medium text-sm">AI Support Agent</span>
                                    <span class="text-xs ${config.bg} ${config.text} px-2 py-0.5 rounded-full">
                                        <i class="${config.icon} mr-1"></i>${config.label}
                                    </span>
                                </div>
                                <p class="text-sm text-foreground">${text}</p>
                                <div class="mt-3 pt-3 border-t border-border">
                                    <div class="flex items-center justify-between text-xs text-muted-foreground">
                                        <span>Response source: ${config.label}</span>
                                        <span>Just now</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Show rate limit warning if approaching limit
                if (queryCount >= 23) {
                    document.getElementById('rateLimitWarning').style.display = 'block';
                }
            }

            function showRAGProcess() {
                document.getElementById('ragProcessModal').classList.remove('hidden');
            }

            function hideRAGProcess() {
                document.getElementById('ragProcessModal').classList.add('hidden');
            }
        })();
    </script>
</body>
</html>